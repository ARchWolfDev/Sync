{% extends "base.html" %}

{% block title %}Admin: Dashboard{% endblock %}
{% block content %}
    <div class="row">
      {% include "admin_nav_tabs.html" %}
      <!-- Create Button Modals -->
      {% include "create_button.html" %}
      <!-- Search -->
      <div class="col-lg-3">
        <form class="d-flex search" role="search" action="" method="post">
          <input class="form-control me-2" id="browser" type="search" name="browser" placeholder="Search" list="browserdata" aria-label="Search" autocomplete="off">
          <button class="btn btn-outline-success" type="submit">Search</button>
          <datalist id="browserdata">
            {% for emp in db.select_all("t_employees") %}
              <option value="{{emp[0]}}">{{ emp[1] + ' ' + emp[2] }}</option>
            {% endfor %}
          </datalist>
        </form>
      </div>
      <!-- Information -->
      <div class="col-lg-9">
        <div class="container">
          <!--filter start-->
          <form action="{{ url_for('admin', id='dashboard') }}" method="post">
            <div class="row mb-3">
              <div class="col char" style="padding: 15px;">
                <!--Departments-->
                <div class="btn-group">
                  <button class="btn btn-light btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                    Department
                  </button>
                  <ul class="dropdown-menu" style="padding: 10px;">
                    {% for dep in db.select_all("t_departments") %}
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" value="{{dep[0]}}" name="department" id="DepartmentCheck" {% if dep[0] in filter['department_id'] %} checked {% endif %}>
                      <label class="form-check-label" for="DepartmentCheck">
                        {{dep[1]}}
                      </label>
                    </div>
                    {% endfor %}
                  </ul>
                </div>
                <!--Date-->
                <div class="btn-group">
                  <button class="btn btn-light btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                    Month
                  </button>
                  <ul class="dropdown-menu" style="padding: 10px;">
                    <input type="month" placeholder="Month" name="date">
                  </ul>
                </div>
                <div style="float:right;">
                  <button type="submit" class="btn btn-primary btn-sm"><i class="fa-solid fa-filter"></i>Apply Filter</button>
                </div>
              </div>
            </div>
          </form>
          <div class="row mb-3">
            <div class="col char" style="background-color:#ffeb99">
              <h5><i class="fa-solid fa-hourglass-end"></i> Pending</h5>
              <hr style="margin: 10px 0px">
              <p class="dash-p">Timesheet <strong style="float:right;">{{dash.count.timesheet(1)}}</strong></p>
              <p class="dash-p">Time off <strong style="float:right;">{{dash.count.timeoff(1, 'all')}}</strong></p>
              <p class="dash-p">&bull; Annual <strong style="float:right;">{{dash.count.timeoff(1, 'AN')}}</strong></p>
              <p class="dash-p">&bull; Medical <strong style="float:right;">{{dash.count.timeoff(1, 'MD')}}</strong></p>
              <p class="dash-p">&bull; Other <strong style="float:right;">{{dash.count.timeoff(1, 'other')}}</strong></p>
            </div>
            <div class="col char" style="background-color:#99ff99">
              <h5><i class="fa-solid fa-check"></i> Approved</h5>
              <hr style="margin: 10px 0px">
              <p class="dash-p">Timesheet <strong style="float:right;">{{dash.count.timesheet(2)}}</strong></p>
              <p class="dash-p">Time off <strong style="float:right;">{{dash.count.timeoff(2, 'all')}}</strong></p>
              <p class="dash-p">&bull; Annual <strong style="float:right;">{{dash.count.timeoff(2, 'AN')}}</strong></p>
              <p class="dash-p">&bull; Medical <strong style="float:right;">{{dash.count.timeoff(2, 'MD')}}</strong></p>
              <p class="dash-p">&bull; Other <strong style="float:right;">{{dash.count.timeoff(2, 'other')}}</strong></p>
            </div>
            <div class="col char" style="background-color:#ff9999">
              <h5><i class="fa-solid fa-x"></i> Rejected</h5>
              <hr style="margin: 10px 0px">
              <p class="dash-p">Timesheet <strong style="float:right;">{{dash.count.timesheet(3)}}</strong></p>
              <p class="dash-p">Time off <strong style="float:right;">{{dash.count.timeoff(3, 'all')}}</strong></p>
              <p class="dash-p">&bull; Annual <strong style="float:right;">{{dash.count.timeoff(3, 'AN')}}</strong></p>
              <p class="dash-p">&bull; Medical <strong style="float:right;">{{dash.count.timeoff(3, 'MD')}}</strong></p>
              <p class="dash-p">&bull; Other <strong style="float:right;">{{dash.count.timeoff(3, 'other')}}</strong></p>
            </div>
            <div class="col-lg-3 char">
              <h5>Most Projects</h5>
              <hr style="margin: 10px 0px">
              {% if db2.Select("t_projects").all()|length == 0 %}
              <h6>No any project yet</h6>
              {% else %}
              <canvas id="myPieChart" style="width:100%; height:200px"></canvas>
              <script>
                var xValues = {{dash.list.projects()|safe}};
                var yValues = {{dash.count.projects()}};
                var barColors = [
                  "#58508d",
                  "#bc5090",
                  "#ff6361",
                  "#ffa600",
                  "#251749"
                ];

                new Chart("myPieChart", {
                  type: "pie",
                  data: {
                    labels: xValues,
                    datasets: [{
                      backgroundColor: barColors,
                      data: yValues
                    }]
                  },
                  options: {
                    legend: {display: false},
                  }
                });
                </script>
                {% endif %}
            </div>
          </div>
          <div class="row mb-3">
            <div class="col char" style="width: 50%">
              <canvas id="myChart" style="width:100%; max-height: 300px;"></canvas>
              <script type="text/javascript">
                var xValues = {{dash.list.employee()|safe}};
                var yValues = {{dash.list.timesheet()}};
                var barColors = "#58508d";

                new Chart("myChart", {
                  type: "bar",
                  data: {
                    labels: xValues,
                    datasets: [{
                      backgroundColor: barColors,
                      data: yValues
                    }]
                  },
                  options: {
                    legend: {display: false},
                    scales: {
                      yAxes: [{
                        ticks: {
                          beginAtZero: true
                        }
                      }],
                    }
                  }
                });
            </script>
            </div>
            <div class="col-lg-3 char">
              <h5>Average</h5>
              <hr style="margin: 10px 0px">
              <canvas id="myAverageChart" style="width:100%; height:200px"></canvas>
              <script>
                var xValues = ["Completed", "Not Completed"];
                var yValues = {{dash.list.average_timesheet()}};
                var barColors = [
                  "green",
                  "#ffeb99",
                  "#2b5797",
                  "#e8c3b9",
                  "#1e7145"
                ];

                new Chart("myAverageChart", {
                  type: "doughnut",
                  data: {
                    labels: xValues,
                    datasets: [{
                      backgroundColor: barColors,
                      data: yValues
                    }]
                  },
                  options: {
                    legend: {display: false},
                  }
                });
                </script>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col char" style="border:solid; border-color: #ff9933;;">
              <h5 style="margin:0">Pending requests <strong style="float:right">{{dash.count.requests(1)}}</strong></h5>
            </div>
            <div class="col char" style="border:solid; border-color: green;">
              <h5 style="margin:0">Done requests <strong style="float:right">{{dash.count.requests(2)}}</strong></h5>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col char">
              <h5 class="title">Time off {{cal.month_name}} {{cal.year}}</h5>
              <div class="row week">
                <div class="col">Sun</div>
                <div class="col">Mon</div>
                <div class="col">Thu</div>
                <div class="col">Wen</div>
                <div class="col">Thr</div>
                <div class="col">Fri</div>
                <div class="col">Sat</div>
              </div>
              {% for week in cal.current_month %}
              <div  style="max-height: 50px;" class="row days">
                {% for day in week %}
                  {% if day == 0 %}
                    <div class="col day" style="background-color:#fff;max-height: 50px;"></div>
                  {% elif day == week[0] or day == week[6] %}
                    <div class="col day" type="button" data-bs-toggle="modal" data-bs-target="#Modal{{day}}" style="color: red;max-height: 50px;">{{ day }}</div>
                  {% else %}
                    <div class="col day" type="button" data-bs-toggle="modal" data-bs-target="#Modal{{day}}" style="max-height: 50px;">{{ day }}
                      <div>
                        <h6 style="font-size:.8rem; text-align: left;">{% if dash.calendar(day) %}People off {% endif %}</h6>
                      </div>
                    </div>
                  {% endif %}
                  <div class="modal fade" id="Modal{{day}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <form >
                      <div class="modal-dialog modal-lg modal-dialog-centered">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h1 class="modal-title fs-5" id="exampleModalLabel" >{{day}}/{{cal.month}}/{{cal.year}}</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <div class="modal-body">
                            <table class="table">
                              <thead>
                                <tr>
                                  <th scope="col">#</th>
                                  <th scope="col">First</th>
                                  <th scope="col">Last</th>
                                  <th scope="col">Handle</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td>off[0]</td>
                                  <td>off[1]</td>
                                  <td>off[2]</td>
                                  <td>off[3]</td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary modal-btn">Save Changes</button>
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>
                {% endfor %}
              </div>
              {% endfor %}
            </div>
            <div class="col-lg-3" style="padding:0;">
              {% for off in dash.off_today() %}
                <div class="char mb-3" style="background-color:#ff9933">
                  <h5>{{off}}</h5>
                  <p style="margin:0;">Off Today</p>
                </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
      {% include "side-admin.html" %}
    </div>
{% endblock %}